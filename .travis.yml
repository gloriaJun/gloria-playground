language: node_js

node_js:
  - 'stable'

cache:
  directories:
    - node_modules

branches:
  only:
    - master
    - develop

# before_install:
# - npm install -g yarn --cache-min 999999999

install:
  - npm install
  # - npm run build-storybook

jobs:
  include:
    - stage: lint
      script: npm run lint

    - stage: unit-test
      script: npm run test
      after_success:
        - npm run coverage

    - stage: gh-pages
      script: npm run build-storybook
      # require the branch name to be master (note for PRs this is the base branch name)
      if: branch = master
      deploy:
        provider: pages
        skip-cleanup: true
        github-token: $GITHUB_TOKEN # Set in travis-ci.org dashboard, marked secure https://docs.travis-ci.com/user/deployment/pages/#Setting-the-GitHub-token
        target-branch: gh-pages
        local-dir: storybook-static
# notifications:
#   email: false
#   slack:
#     rooms:
#       - glriaroom:$SLACK_TOKEN#devops
#     on_success: change # default : always
#     on_failure: always # default : always
